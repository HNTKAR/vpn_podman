#!/bin/bash

key=""
allow="0.0.0.0/0"


while getopts ":k:a" OPT;do
    case $OPT in
        a) allow="10.0.0.0/8,172.16.0.0/12,192.168.0.0/16";;
        k) key=$OPTARG;;
        *) echo "option Error: $OPT is not a valid option"
        exit;;
    esac
done

if [ -z "$key" ]; then
    echo "Public key is required"
    exit 1
fi


wg set wg0 \
    peer $key \
    allowed-ips $allow
wg showconf wg0 > /usr/$POD_NAME/$CONTAINER_NAME/conf/wg0.conf
wg syncconf wg0 /usr/$POD_NAME/$CONTAINER_NAME/conf/wg0.conf

ip link set down dev wg0
ip link set up dev wg0

wg
